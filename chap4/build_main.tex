% NOTES 
% Wie ich den sprinback gemssen habe 

\chapter{Build}

\section{Problem Statement} 
With progression in manufacturing there is a growing demand for high-quality products, that means that the meta parts needs to be produced with high precision and accuracy. Here the sprin back is an undesired side effect which need to be mimimized. \cite[p. 1]{baig_machinelearningprediction_2021}
Sheet metal forming in manufacturing need a high level of quality and precision. Therefore, the spring back of a sheet metal is an important parameter to consider. \cite[p. 1]{cruz_applicationmachinelearning_2021}
Predicting spring back is important to reduce the number of trial and error cycles in the manufacturing process.
Also predicting spring back is complex because of many variables and parameters and often not all of them are known. 
Therefore, a machine learning model should predict the spring back of a sheet metal with a high accuracy and correctness. When using the \ac{ML} model small errors in the prediction can cause fitting problems in the manufacturing process.

% Nevertheless, it should be noticed that there
% are numerous variables involved in sheet metal forming
% process, which are related to the material properties, the
% tools geometry and process parameters. This makes the
% optimization of process conditions quite complex, partic-
% ularly in the production of components which require
% several stages, and thus more than one set of tools.
% \cite[]{dib_singleensembleclassifiers_2020}

\paragraph*{\textbf{Design Principle 1}: Correctness}
Does the artifact predict the spring back of a sheet metal with a high accuracy and correctness?

% Prediction of new cases 
\paragraph*{\textbf{Design Principle 2}: Appropriateness}
Is the artifact appropriate for the given problem?

\paragraph*{\textbf{Design Principle 3}: Relevance}
Does the artifact achieve a good bias-variance trade-off?

\paragraph*{\textbf{Design Principle 4}: Robustness}
How well does the artifact handle outliers, noise and missing data?

\paragraph*{\textbf{Design Principle 5}: Stability}
Does the artifact generate repeatable results when trained on different datasets?


% “Sheet metal forming includes simple processes, such as bending, stretch forming and spinning, and more complex processes, like roll forming and deep drawing [16]. Each type of process has its specifications and parameters, including the tools geometry. Process design becomes even more complex when it is required to combine several processes and/or steps to produce the component. The main driver for the development of numerical tools, enabling the virtual tryout of sheet metal forming components, is the industry, in particular the automotive industry, due to the enormous amount of components involved in car production. The outer panels are usually the largest components, and their production involves the most complex operations, including deep drawing.” ([Dib et al., 2020, p. 2](zotero://select/library/items/GIQLS492)) ([pdf](zotero://open-pdf/library/items/EP7HGFT8?page=2&annotation=JVHVQTJS))

\paragraph*{\textbf{Design Principle 6}: Interpretability}
Is the artifact easy to understand and explain?

Conventional processes are often based on empirical trial and error approaches. \cite[p. 1]{dib_singleensembleclassifiers_2020}
A common approach is to experimentally create so named 'technology tables' which contain the bending parameters and the resulting spring back. (Quelle: Hochstrate?)
This process is time and cost intensive and therefore often not suitable for the production of high-volume and low-cost components.
Therefore, one of the benefits of using machine learning should be the reduction of the number of trial and error cycles in the manufacturing process. 
Furthermore, training the model should take not too much time and resources.

\paragraph*{\textbf{Design Principle 7}: Resource utilization}
How many resources does the artifact need to train and predict?



\section{Dataset generation}
For the dataset generation, bending experiments were performed on metal sheets with different thicknesses.
% material
The material used is cold rolled steel sheets of the norm DIN EN 10130. The thicknesses used were 0.5mm, 1mmm and 2mm.
The material was used because it is commonly used in bending processes and its high availability. In previous tests, it was observed, that the spring back are well observable with this material.
Using this material, 200 single bending pieces of the dimension 20×100 mm have been cut.
Each piece was bend one time using a \textit{Zwick} three-point-bending machine.

Python script where developed to covert the output data format from the machine to CSV files.
The following describes the experimental setup used for the experiments performed.

\subsection{Preliminary Tests}
A number of preliminary tests were conducted to determine the influence of the punch penetration on the spring back.

\subsubsection{Multiple Cycles}
One approach was to test if multiple spring back can be measure using only one sheet.
Therefore, the machine was programmed to perform multiple cycles in one attempt and bend the metal sheet multiple times. The benefit of this approach would have been a faster generation of the dataset because spring backs could be measured in on attempt, also less material would have been used.

Figure~\ref{springback_multiple} shows one of these attempts. The metal sheet was bent 4 times using $y_p$ values from 5 to 8. The results show, that 4 different spring backs can be measured, but the spring back does not vary like expected. It was observed as well, that the spring backs are different in every attempt, this is shown in Figure~\ref{springback_multiple_inconsistent_results}.
Bending 4 different metal sheets each only one time returned very different results.
A possible explanation could be the cold deformation of the steel, which is not reversible. Because this approach did not work, the machine was programmed to perform one cycle at a time.

\captionsetup{width=0.45\textwidth}

\begin{figure}[H]
    \centering
    \begin{minipage}[b]{0.5\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth]{springback_multiple.jpg} % first figure itself
        \caption{Experiment: Bending one metal sheet multiple times with different $y_p$ values.}
        \label{springback_multiple}
    \end{minipage}\hfill
    \begin{minipage}[b]{0.5\textwidth}
        \centering
        \includegraphics[width=1.1\textwidth]{springback_multiple_inconsistent_results.png} % second figure itself
        \caption{Inconsisten results bending one metal sheet mutliple times. The spread of the results is very large.}
        \label{springback_multiple_inconsistent_results}
    \end{minipage}
    \label{fig:springback_multiple_overview}
\end{figure}

\subsubsection{Brake Bending Machine}
Before using the three point bending machine, a brake bending machine was used to test the influence of the bending on the spring back. The brake bending machine is a machine used to bend metal sheets. It is a very common machine in the industry and is used to bend metal sheets to a specific radius. The brake bending machine used is a \textit{Bendmaster 1000} from \textit{Bendmaster}.

After a series of bends it was observed, that the spring back values where much higher than expected. The explanation for that behavior was, that altering the position the bending beam of that specific machine was not enough to get the desired angle. Thus, the machine excluded for the generation of the data and the three point bending machine was used instead.

Despite the inaccurate data, it was later observed, that the distribution of the spring backs was very similar to the later experiments with the three point bending machine.


\subsection{Experimental setup}
The setup consists of a three-point-bending machine with a punch and a die with no bottom. The machine used is the \textit{Zwick MX 25A} material testing machine.
The machine is equipped with a load cell and a displacement sensor. The load cell is used to measure the force applied to the sheet and the displacement sensor is used to measure the displacement of the punch.
The machine is controlled by a computer and a software called \textit{ZwickRoell TestXpert}. The software is used to control the machine and to save the output data.

The experimental setup and its parameters are shown in Figure~\ref{fig:setup} where $V$ is the die opening, $y_p$ is the punch penetration which is the distance the punch is moved into the sheet.
The paramter $t$ is the sheet thickness,  $\alpha$ is the sheet corresponding bending angle. Parameter $r_p$ is the punch radius which is the radius of the tip of the punch and $r_m$ is the die radius.



\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{setup}
    \caption{Experimental setup: sheet bending angle ($\alpha$), sheet thickness ($t$), punch penetration ($y_p$), die opening ($V$), punch radius ($r_p$), die radius ($r_m$), inside bending radius ($r_i$).}
    \label{fig:setup}
\end{figure}

In order to get consistent results, a number of constant and variable parameters were chosen.
The parameters include the punch-and-die tooling made of steel where die punch had a radius ($r_p$) of 5 mm and and die radius ($r_m$) of 10 mm. The die opening $V$ was varied between 10 and 50 mm and the punch penetration $y_p$ was varied between 0 and 20 mm.
The machine was configured to move the punch with a constant speed of 100 mm/min until it measured a resistance of 1 N. That meant, that the punch reached the metal plate and the actual bending process can start. After a hold time of 1 second the punch was moved with a slower speed of 8 mm/min until the specified punch penetration was reached.
The length and width of the metal sheet was 100 mm and 20 mm respectively. The sheet thickness was varied between 0.5 and 3 mm.
The constant parameters are shown in Table~\ref{tab:constant_parameters} and the varying parameters are shown in Table~\ref{tab:verying_parameters}.

\begin{table}[H]
    \centering
    \begin{tabular}{|l|l|l|}
        \hline
        \textbf{Parameter} & \textbf{Value}                      & \textbf{Unit} \\ \hline
        Punch penetration  & 2.5, 5, 7.5, 10, 12.5, 15, 17.5, 20 & mm            \\
        Die opening        & 10, 20, 30, 40, 50                  & mm            \\
        Thickness          & 0,5, 1, 1.5, 2, 2.5, 3              & mm            \\
        \hline
    \end{tabular}
    \caption{Experimental setup varying parameters}
    \label{tab:verying_parameters}
\end{table}

\begin{table}[H]
    \centering
    \begin{tabular}{|l|l|l|}
        \hline
        \textbf{Parameter}            & \textbf{Value} & \textbf{Unit} \\ \hline
        Punch radius                  & 5              & mm            \\
        Die radius                    & 5              & mm            \\
        Sheet thickness               & 0.5, 1, 2      & mm            \\
        Sheet width                   & 20             & mm            \\
        Sheet length                  & 100            & mm            \\
        Punch speed                   & 100            & mm/min        \\
        Punch speed after penetration & 8              & mm/min        \\
        Punch force                   & 1              & N             \\
        \hline
    \end{tabular}
    \caption{Experimental setup constant parameters}
    \label{tab:constant_parameters}
\end{table}


\subsection{Measuring The Spring Back}
The output data contained different data points, which were used to calculate the spring back.
Important parameters for the calculation are the force, punch penetration and testing time.
As shown in Figure~\ref{fig:springback_measured} at the $yp$ maximum the punch penetration and the force are maximized as well. The punch stays at that position for 1 second and then moves back with a slower speed. This hold time a limitation of the machine and can not be changed.
After the punch is moved back, the force is reduced and the punch penetration is reduced as well, until the punch is at the initial position. For a short time after the lift, the load  cell still measures a force. That is because the metal sheet springs back and the punch is still in contact with the sheet. This was measured using a python script, the green and the yellow point represent the resulting spring back distance.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{springback_measured}
    \caption{A steel metal sheet was bent with a punch penetration of 5 mm the spring back is 0.37 mm. The blue line shows the force and the blue line shows the punch penetration.}
    \label{fig:springback_measured}
\end{figure}

% \paragraph{Bend deduction:}
% Measuring the bend deduction is more complex. After a metal sheet is bent, it is hard to measure the flat pattern length because the material is malformed at the bent. 
% As a result, the neutral axis is not in the center of the sheet and hard to measure, but it can be calculated using different approaches. %quelle und ausführlicher und grunlagen teil  
% There are multiple ways to measure the bend deduction described earlier. 
% % K-Faktor Muss noch in theorie teil 
% In this setup, the method described in the DIN6395 was used. This method uses a k-factor which is an approximated value and therefore and therefore it can be inaccurate. (Equation~\ref{eq:kfactor}). % cite DIN norm 

% \begin{equation}\label{eq:kfactor}
%     k=0.65+\frac{1}{2}\log{\frac{r}{s}}
% \end{equation}

% \begin{figure}[ht!] % supposedly places it here ...
% 	\centering
% 	\includegraphics[width=0.5\linewidth]{k-factor}
% 	\caption[Graphical representation of the correction factor]{Graphical representation of the correction factor.}
% 	\label{fig:test1}
% \end{figure}

% The DIN 6935 used the formula for the stretched length, $length=a+b+v$ where \textit{a} and \textit{b} are the side lengths of the sheet and \textit{v} is a correction value for the deduction. \cite{din6935}
% The stretched length is measured different depending on the bending angle.

% \paragraph{Opening angle $\beta 0^\circ$ to $90^\circ$} 
% For opening angles between $0^\circ$and $90^\circ$ the side lengths \textit{a} and \textit{b} are dimensioned from the tangent of the bend to the edge. 
% To calculate the compensation value \textit{v} (Equation~\ref{eq:v1}) is used
% \cite{din6935}.

% \begin{equation}\label{eq:v1}
%         v=\pi*(\frac{180^\circ-}{180^\circ})*(r+\frac{s}{2}*k)-2(r+s)
% \end{equation}

% \begin{figure}[H]
% 	\centering
% 	\includegraphics[width=0.5\linewidth]{bending-angle-90}
% 	\caption[Opening angles $\beta 0^\circ$ to $90^\circ$]{Opening angles $\beta 0^\circ$ to $90^\circ$ \cite{din6935}}
% 	\label{fig:v1-image}
% \end{figure}

% \paragraph{Bending angle $\beta90^\circ$ to $165^\circ$} (Equation~\ref{eq:v1})
% For opening angles between $90^\circ$ and $165^\circ$ the side lengths \textit{a} and \textit{b} are dimensioned from the apex to the edge. 
% To calculate the compensation value \textit{v} (Equation~\ref{eq:v1}) is used. 
% \cite{din6935}

% \begin{equation}\label{eq:v2}
%     v=\pi*(\frac{180^\circ-}{180^\circ})*(r+\frac{s}{2}*k)-2(r+s)+\tan{\frac{180^\circ-\beta}{2}}
% \end{equation}

% \begin{figure}[!ht]
% 	\centering
% 	\includegraphics[width=0.5\linewidth]{bending-angle-165}
% 	\caption[Opening angles $\beta90^\circ$ to $165^\circ$]{Opening angles $\beta90^\circ$ to $165^\circ$ \cite{din6935}}
% 	\label{fig:v2-image}
% \end{figure}

% For opening angles between $165^\circ$ and $180^\circ$ the compensation value \textit{v} is 0. The values for v would be negligibly small. \cite{din6935} The side lengths \textit{a} and \textit{b} where measured using the software \textit{ImageJ}. 

% Edge cracking is not measured for now because the steel used has no high-strength and with machine in usage it was not possible to create edge cracking.

% \begin{figure}[!ht]
% 	\centering
% 	\includegraphics[width=0.5\linewidth]{example-image}
% 	\caption[Screenshot ImageJ]{Screenshot ImageJ}
% 	\label{fig:imagej-screenshot}
% \end{figure}


\subsection{Computational Setup}
For training the machine learning models a ThinkPad X1 Carbon 2019 with an Intel Core i7-10610U CPU @ 1.80GHz and 16 GB RAM was used. The operating system used is Ubuntu 20.04.2 LTS. The code for the model is written in Python 3.8.5 using the IDE PyCharm The libraries used are mentioned in Table

\captionsetup{width=1\textwidth}

\begin{table}[H]
    \centering
    \begin{tabular}{|ll|}
        \hline
        \textbf{Library} & \textbf{Version} \\
        \hline
        numpy        & 1.23.2  \\
        pandas       & 1.5.1   \\
        matplotlib   & 3.6.2  \\ \hline 
    \end{tabular}
    \label{table:libraries}
    \caption{Libraries used for the machine learning models.}
\end{table}

\subsection{Data Preprocessing}
% "Although the dataset collected from the experimental setup includes seven features (parameters), the 
% first three parameters; load tonnage, load holding time, and gap between the punch and the die, are 
% combined to form a single feature, "Machine". It is because different combinations of these factors may 
% be combined to form a single machine setting parameters. The other parameters are; blank material, 
% thickness, width and initial bend angle. Hence, there are five features of the dataset, which levels are 
% shown in Table 4. Two of which, namely machine and material, are treated as categorical features, so 
% using scikit-learn's OrdinalEncoder these features were encoded into an integer array. While the 
% remaining three features were treated as continuous features, for standardizing these features scikit-
% learn's StandardScaler was used. It transformed the data so that for each feature, its distribution 
% will have a mean value of 0 and a standard deviation of 1. The formula used for this is as follows Eq 
% (1)." 
% \cite[p. 7]{baig_machinelearningprediction_2021}

\section{Model Selection}



\section{Model Training}








